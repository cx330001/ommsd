<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes" />
    <title>sisi</title>
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" href="https://img3.autoimg.cn/g33/M04/BB/6C/ChxpVWlVaV6AdegHAALyV1UsDVk85.jpeg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0f2f5">
</head>

<body>

    <div id="phone-screen">
        <div id="home-screen">
            <div id="desktop-app-container">
                <div class="desktop-app-icon" onclick="openApp('chat')">
                    <div class="icon-bg-desktop" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="36" height="36" fill="white">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                        </svg>
                    </div>
                    <span class="label">WeChat</span>
                </div>
                <div class="desktop-app-icon" onclick="openApp('settings')">
                    <div class="icon-bg-desktop" style="background: #ffffff;">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="#9B9ECE">
                            <path
                                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                        </svg>
                    </div>
                    <span class="label">ËÆæÁΩÆ</span>
                </div>
                <div class="desktop-app-icon" onclick="openApp('worldbook')">
                    <div class="icon-bg-desktop" style="background: #E8C1C6;">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="white">
                            <path
                                d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" />
                        </svg>
                    </div>
                    <span class="label">‰∏ñÁïå‰π¶</span>
                </div>
            </div>
        </div>
        <div id="app-settings" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('settings')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>

                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">ËÆæÁΩÆ</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body">
                <div class="setting-group">
                    <div class="setting-row" onclick="openSubPage('api')">
                        <span class="setting-row-title">API ËÆæÁΩÆ</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                    <div class="setting-row">
                        <span class="setting-row-title">ÈÄöÁî®</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>
                <div style="padding:20px; text-align:center; color:#ccc; font-size:12px;">
                    Version 1.0.0
                </div>
            </div>

            <div id="sub-page-api" class="sub-page">
                <div class="app-header">
                    <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                    <div class="header-content">
                        <div class="header-left" onclick="closeSubPage('api')" style="width: 40px; padding-left: 5px;">
                            <svg viewBox="0 0 24 24" width="28" height="28">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                        </div>
                        <div class="header-title"><span style="font-size:17px;font-weight:600;">API ÈÖçÁΩÆ</span></div>
                        <div class="header-right" style="width:40px;"></div>
                    </div>
                </div>

                <div class="app-body" style="padding: 20px 16px;">
                    <label class="setting-label">API ÂéÇÂïÜ</label>
                    <div class="input-wrapper">
                        <select id="api-provider" class="setting-input" style="background-image:none;"
                            onchange="toggleApiProvider(this.value)">
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="google">Google (Gemini)</option>
                        </select>
                    </div>
                    <label class="setting-label">API Base URL (ÈÄâÂ°´)</label>
                    <div class="input-wrapper">
                        <input type="text" id="api-host" class="setting-input" placeholder="https://api.openai.com/v1">
                    </div>

                    <label class="setting-label">API Key (Â§öKeyËØ∑Áî®Ëã±ÊñáÈÄóÂè∑ÂàÜÈöî)</label>
                    <div class="input-wrapper">
                        <input type="password" id="api-key" class="setting-input"
                            placeholder="sk-aaa, sk-bbb, sk-ccc...">
                    </div>

                    <label class="setting-label">Ê®°ÂûãÈÄâÊã©</label>
                    <div class="model-selector-box">
                        <div id="current-model-text" class="model-display" onclick="toggleModelList()">
                            Êú™ÈÄâÊã©Ê®°Âûã
                        </div>
                        <div class="fetch-btn" onclick="fetchModels(event)">
                            <svg id="fetch-icon" viewBox="0 0 24 24" width="20" height="20" fill="#9B9ECE">
                                <path
                                    d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                            </svg>
                        </div>
                    </div>

                    <div id="model-list-container" class="model-dropdown"></div>
                    <label class="setting-label" style="margin-top: 20px;">
                        Ê∏©Â∫¶ (ÂàõÈÄ†ÊÄß): <span id="temp-display" style="color:#9B9ECE; font-weight:bold;">0.7</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="range" id="api-temp" style="width:100%;" min="0" max="2" step="0.1" value="0.7"
                            oninput="document.getElementById('temp-display').innerText = this.value">
                    </div>


                    <div style="margin-top: 30px;">
                        <button class="btn-main" onclick="manualSaveApi()">‰øùÂ≠òÈÖçÁΩÆ</button>
                    </div>

                </div>
            </div>
        </div>
        <div id="app-chat" class="app-window">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('chat')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="app-title-text">Ê∂àÊÅØ</span></div>

                    <div id="btn-add-contact" class="header-right" onclick="openContactPage()" style="display:none;">
                        <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body">
                <div id="tab-msgs" class="tab-content active">
                    <div id="msg-list"></div>
                </div>

                <div id="tab-contacts" class="tab-content">

                    <div class="menu-item" onclick="openGroupCreateUI()"
                        style="margin: 16px 16px 10px 16px; height: 70px; box-sizing: border-box;">
                        <div class="avatar"
                            style="width:40px; height:40px; background:#9B9ECE; display:flex; align-items:center; justify-content:center;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </div>
                        <div class="chat-info" style="flex-grow:1;">
                            <h4 style="margin:0;">ÂèëËµ∑Áæ§ËÅä</h4>
                            <p style="margin:0; font-size:12px; color:#999;">ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÂ§ö‰∫∫‰ºöËØù</p>
                        </div>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                    <div id="contact-list-dynamic"></div>
                </div>

                <div id="tab-moment" class="tab-content">
                    <div class="menu-item">
                        <div class="avatar" style="width:30px; height:30px; background:none;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="#E8C1C6">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                            </svg>
                        </div>
                        <div class="chat-info">
                            <h4>ÊúãÂèãÂúà</h4>
                        </div>
                    </div>
                </div>

                <div id="tab-me" class="tab-content">
                    <div id="me-content-placeholder"></div>
                </div>
            </div>

            <div class="app-tabbar">
                <div class="tab-item active" onclick="switchTab('msgs', this)">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                    </svg>
                    <span>Ê∂àÊÅØ</span>
                </div>
                <div class="tab-item" onclick="switchTab('contacts', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                    </svg><span>Â•ΩÂèã</span>
                </div>
                <div class="tab-item" onclick="switchTab('moment', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z" />
                    </svg><span>ÂèëÁé∞</span>
                </div>
                <div class="tab-item" onclick="switchTab('me', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg><span>Êàë</span>
                </div>
            </div>
        </div>
        <div id="app-conversation" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('conversation')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title conversation-header">
                        <span id="chat-title-text">ËÅäÂ§©</span>
                        <div class="status-container">
                            <span id="chat-status-dot" class="status-dot"></span>
                            <span id="chat-status-text">Á¶ªÁ∫ø</span>
                        </div>
                    </div>
                    <div class="header-right" onclick="openChatSettings()"
                        style="width:40px; display:flex; justify-content:center;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="#9B9ECE">
                            <path
                                d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body" id="chat-body" style="padding-bottom: 70px; background: #F9F9FC;">
            </div>

            <div class="chat-footer">
                <div class="icon-btn" onclick="toggleFeaturePanel()">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </div>

                <input type="text" class="chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." />

                <div class="icon-btn" onclick="toggleChatStickerPanel()">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path
                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
                    </svg>
                </div>

                <div class="icon-btn ai-send-btn" onclick="triggerAIResponse(this)">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                        <path
                            d="M21.435 2.582a1.933 1.933 0 00-1.93-.503L3.408 6.759a1.92 1.92 0 00-1.384 1.522c-.142.75.355 1.704 1.003 2.102l5.033 3.094 2.054 3.83c.21.39.426.779.803.957.25.119.531.149.789.043.435-.178.68-.621.844-1.049l.643-1.685 4.095 2.517c.504.31.956.276 1.342-.037.456-.37.648-.96.721-1.536l2.365-11.87a1.986 1.986 0 00-.281-1.666zM18.89 5.385l-8.55 7.684-1.748-1.075 10.298-6.609z" />
                    </svg>
                </div>
            </div>
            <div id="chat-feature-panel">
                <div class="feature-item" onclick="handleVoiceSend()">
                    <div class="feature-icon-box" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="white">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.66 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                    </div>
                    <div class="feature-name">ËØ≠Èü≥</div>
                </div>

                <div class="feature-item" onclick="handlePhotoPanel()">
                    <div class="feature-icon-box" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="white">
                            <path
                                d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                        </svg>
                    </div>
                    <div class="feature-name">ÁÖßÁâá</div>
                </div>

                <div class="feature-item">
                    <div class="feature-icon-box" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="white">
                            <path
                                d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                        </svg>
                    </div>
                    <div class="feature-name">ÊãçÊëÑ</div>
                </div>
            </div>
            <div id="chat-sticker-panel" style="display:none;">
                <div class="sticker-panel-header-bar"
                    style="display:flex; align-items:center; border-bottom:1px solid #eee; background:#fff; padding-right:10px;">
                    <div id="chat-sticker-tabs" class="category-scroll-container"
                        style="flex-grow:1; padding: 8px 10px; border-bottom:none; margin-bottom:0;"></div>

                    <div onclick="openStickerMountModal()"
                        style="padding: 6px; cursor:pointer; color:#999; display:flex;">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z">
                            </path>
                        </svg>
                    </div>
                </div>

                <div id="chat-sticker-body" style="flex:1; overflow-y:auto; padding:10px; position:relative;"></div>
            </div>
        </div>
        <div id="modal-sticker-mount" class="modal-overlay" style="z-index: 650;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-sticker-mount').style.display='none'">√ó
                </div>
                <h3 style="margin-top:0;">Ë°®ÊÉÖÂåÖÁÆ°ÁêÜ</h3>
                <p style="font-size:12px;color:#999;margin-bottom:15px;">ÂãæÈÄâË¶ÅÂú®Ëøô‰∏™ËÅäÂ§©‰∏≠ÊòæÁ§∫ÁöÑË°®ÊÉÖÂåÖ</p>

                <div id="st-mount-list" style="max-height:300px; overflow-y:auto;"></div>

                <button class="btn-main" onclick="saveStickerMount()">‰øùÂ≠òËÆæÁΩÆ</button>
            </div>
        </div>
        <div id="modal-select-me" class="modal-overlay">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-select-me').style.display='none'">√ó
                </div>
                <h3 style="margin-top:0;">ÊàëÊòØË∞ÅÔºü</h3>
                <p style="color:#999; font-size:12px; margin-bottom:15px;">ËØ∑ÈÄâÊã©‰Ω†Ë¶Å‰ΩøÁî®ÁöÑË∫´‰ªΩÈù¢ÂÖ∑</p>
                <div id="persona-select-list" style="max-height:250px; overflow-y:auto;"></div>
            </div>
        </div>

        <div id="app-persona-mgr" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="handlePersonaBack()">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="persona-page-title"
                            style="font-size:17px;font-weight:600;">ÊàëÁöÑË∫´‰ªΩ</span></div>
                    <div id="btn-add-persona" class="header-right" onclick="showPersonaForm()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="#9B9ECE">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <div id="view-persona-list">
                    <p style="font-size:12px;color:#999;margin-bottom:15px;text-align:center;">ÁÇπÂáªÂç°ÁâáÂàáÊç¢ÂΩìÂâç‰ΩøÁî®ÁöÑË∫´‰ªΩ</p>
                    <div id="persona-list-container">
                    </div>
                </div>

                <div id="view-persona-form" style="display:none;">
                    <div style="text-align:center; margin-bottom:25px;">
                        <div class="avatar-tabs">
                            <div class="avatar-tab active" id="tab-file" onclick="toggleAvatarMode('file')">Êú¨Âú∞‰∏ä‰º†</div>
                            <div class="avatar-tab" id="tab-url" onclick="toggleAvatarMode('url')">URLÈìæÊé•</div>
                        </div>

                        <div id="input-group-file" class="avatar-upload"
                            onclick="document.getElementById('file-input').click()"
                            style="width:80px;height:80px;background:#fff;border-radius:20px;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #eee;box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                            <img id="preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                            <span id="ph-file"
                                style="font-size:12px;color:#999;display:flex;flex-direction:column;align-items:center;">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc" style="margin-bottom:4px;">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                </svg>
                                ‰∏ä‰º†
                            </span>
                        </div>
                        <input type="file" id="file-input" hidden accept="image/*" onchange="handleFile(this)">

                        <div id="input-group-url" style="display:none; margin-top:10px;">
                            <input type="text" id="url-input" class="setting-input" placeholder="Á≤òË¥¥ÂõæÁâáÈìæÊé•..."
                                oninput="handleUrl(this)">
                            <div
                                style="width:80px;height:80px;background:#fff;border-radius:20px;margin:15px auto 0;overflow:hidden;border:1px solid #eee;">
                                <img id="preview-url" src=""
                                    style="width:100%;height:100%;object-fit:cover;display:none;">
                            </div>
                        </div>
                    </div>

                    <label class="setting-label">ÂßìÂêç</label>
                    <div class="input-wrapper">
                        <input type="text" id="inp-name" class="setting-input" placeholder="‰Ω†ÁöÑÂêçÂ≠ó">
                    </div>

                    <label class="setting-label">‰∫∫ËÆæÊèèËø∞</label>
                    <div class="input-wrapper">
                        <textarea id="inp-desc" class="setting-input"
                            style="height:120px; padding-top:12px; line-height:1.5;"
                            placeholder="ÂÜôÁÇπ‰ªÄ‰πà‰∫∫ËÆæÊèèËø∞Âêß..."></textarea>
                    </div>



                    <div style="height:40px;"></div>
                    <button class="btn-main" onclick="savePersona()"
                        style="box-shadow: 0 5px 15px rgba(155, 158, 206, 0.4);">‰øùÂ≠òË∫´‰ªΩ</button>
                    <div style="height:30px;"></div>
                </div>
            </div>
        </div>

        <div id="btn-add-contact" class="header-right" onclick="openContactPage()" style="display:none;">
            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
        </div>

        <div id="app-contact-edit" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeContactPage()">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="contact-page-title"
                            style="font-size:17px;font-weight:600;">Ê∑ªÂä†Â•ΩÂèã</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <div style="text-align:center; margin-bottom:25px;">
                    <div class="avatar-tabs">
                        <div class="avatar-tab active" id="tab-c-file" onclick="toggleContactMode('file')">Êú¨Âú∞‰∏ä‰º†</div>
                        <div class="avatar-tab" id="tab-c-url" onclick="toggleContactMode('url')">URLÈìæÊé•</div>
                    </div>

                    <div id="c-input-group-file" class="avatar-upload"
                        onclick="document.getElementById('c-file-input').click()"
                        style="width:80px;height:80px;background:#fff;border-radius:20px;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #eee;box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                        <img id="c-preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                        <span id="c-ph-file"
                            style="font-size:12px;color:#999;display:flex;flex-direction:column;align-items:center;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc" style="margin-bottom:4px;">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            ‰∏ä‰º†
                        </span>
                    </div>
                    <input type="file" id="c-file-input" hidden accept="image/*" onchange="handleContactFile(this)">

                    <div id="c-input-group-url" style="display:none; margin-top:10px;">
                        <input type="text" id="c-url-input" class="setting-input" placeholder="Á≤òË¥¥ÂõæÁâáÈìæÊé•..."
                            oninput="handleContactUrl(this)">
                        <div
                            style="width:80px;height:80px;background:#fff;border-radius:20px;margin:15px auto 0;overflow:hidden;border:1px solid #eee;">
                            <img id="c-preview-url" src=""
                                style="width:100%;height:100%;object-fit:cover;display:none;">
                        </div>
                    </div>
                </div>

                <label class="setting-label">ÂßìÂêç / ÊòµÁß∞</label>
                <div class="input-wrapper">
                    <input type="text" id="c-inp-name" class="setting-input" placeholder="ÁªôTAËµ∑‰∏™ÂêçÂ≠ó">
                </div>

                <label class="setting-label">‰∫∫ËÆæÊèèËø∞ / Â§áÊ≥®</label>
                <div class="input-wrapper">
                    <textarea id="c-inp-desc" class="setting-input"
                        style="height:120px; padding-top:12px; line-height:1.5;"
                        placeholder="ËæìÂÖ•ËØ¶ÁªÜÁöÑ‰∫∫ËÆæÊèèËø∞„ÄÅÊÄßÊ†ºÁâπÂæÅÊàñÂ§áÊ≥®‰ø°ÊÅØ..."></textarea>
                </div>



                <div style="height:40px;"></div> <button class="btn-main" onclick="saveContact()"
                    style="box-shadow: 0 5px 15px rgba(155, 158, 206, 0.4);">‰øùÂ≠òËµÑÊñô</button>
                <div style="height:30px;"></div>
            </div>
        </div>
        <div id="app-group-create" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('group-create')">
                        <span style="font-size:16px;color:#666;">ÂèñÊ∂à</span>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">ÂèëËµ∑Áæ§ËÅä</span></div>
                    <div class="header-right" onclick="submitCreateGroup()">
                        <span style="font-size:16px;color:var(--theme-purple);font-weight:600;">ÂÆåÊàê</span>
                    </div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <label class="setting-label">Áæ§ËÅäÂêçÁß∞</label>
                <div class="input-wrapper">
                    <input type="text" id="group-name-input" class="setting-input" placeholder="‰æãÂ¶ÇÔºöÂºÇ‰∏ñÁïåÂÜíÈô©Â∞èÈòü">
                </div>

                <label class="setting-label">ÈÄâÊã©‰Ω†ÁöÑË∫´‰ªΩ (ÊàëÊòØË∞Å)</label>
                <div id="group-me-list" class="select-list-container">
                </div>

                <label class="setting-label" style="margin-top:20px;">ÈÄâÊã©Áæ§ÊàêÂëò (ÈÇÄËØ∑Ë∞Å)</label>
                <div id="group-contact-list" class="select-list-container">
                </div>

                <div style="height:50px;"></div>
            </div>
        </div>

        <div id="app-chat-settings" class="app-window" style="background: #F2F2F7;">
            <div class="app-header" style="background: #fff;">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('chat-settings')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">ËÅäÂ§©ËÆæÁΩÆ</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body">
                <div style="margin: 20px 0 8px 20px; font-size:13px; color:#888;">Â§ñËßÇ</div>
                <div class="ios-group">
                    <div class="setting-row" onclick="openSubPage('visual')">
                        <div class="ios-text-box">
                            <div class="ios-title">Â§¥ÂÉè‰∏éÊòµÁß∞</div>
                        </div>
                        <svg class="ios-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>

                <div style="margin: 0 0 8px 20px; font-size:13px; color:#888;">ËÆ∞ÂøÜ‰∏éËÆæÂÆö</div>
                <div class="ios-group">
                    <div class="setting-row">
                        <div class="ios-text-box">
                            <div class="ios-title">Áü≠ÊúüËÆ∞ÂøÜ</div>
                            <div class="ios-desc">Êê∫Â∏¶ÁöÑÂéÜÂè≤Ê∂àÊÅØÊï∞Èáè</div>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <input type="number" id="setting-context-limit" value="25" class="ios-value-input"
                                onchange="saveContextLimit(this.value)">
                            <span style="color:#8E8E93; font-size:15px; margin-left:4px;">Êù°</span>
                        </div>
                    </div>

                    <div class="setting-row" onclick="openWorldBookMountSelector()">
                        <div class="ios-text-box">
                            <div class="ios-title">‰∏ñÁïå‰π¶ÊåÇËΩΩ</div>
                            <div id="wb-mount-status" class="ios-desc">Êú™ÊåÇËΩΩÂ±ÄÈÉ®ËÆæÂÆö</div>
                        </div>
                        <svg class="ios-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>

                <div style="margin: 0 0 8px 20px; font-size:13px; color:#888;">ÁéØÂ¢É</div>
                <div class="ios-group">
                    <div class="setting-row">
                        <div class="ios-text-box">
                            <div class="ios-title">ÁéØÂ¢ÉÂ¢ûÂº∫Ê®°Âºè</div>
                            <div class="ios-desc">ÂÆûÊó∂Ê≥®ÂÖ•Êó∂Èó¥„ÄÅÂ§©Ê∞îÂíåÊó∂Â∑Æ</div>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="env-mode-switch" onchange="toggleEnvMode(this)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div id="env-settings-panel" style="display:none; background:#fff;">
                        <div id="view-mode-single" class="city-info-box">
                            <div class="flight-connector">
                                <svg class="flight-path-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <path class="flight-line-bg" d="M 0,75 C 80,75 220,25 300,25" />
                                    <path class="flight-line-dash" d="M 0,75 C 80,75 220,25 300,25" />
                                </svg>
                                <div class="plane-wrapper">
                                    <svg viewBox="0 0 24 24" width="24" height="24">
                                        <path
                                            d="M21,16V14L13,9V3.5A1.5,1.5,0,0,0,11.5,2A1.5,1.5,0,0,0,10,3.5V9L2,14V16L10,13.5V19L8,20.5V22L11.5,21L15,22V20.5L13,19V13.5L21,16Z" />
                                    </svg>
                                </div>
                            </div>
                            <div class="city-card" onclick="openCityModal('user')">
                                <div class="city-card-header">
                                    <div class="city-icon-bg"><svg viewBox="0 0 24 24" width="20" height="20"
                                            fill="#9B9ECE">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                        </svg></div>
                                    <div class="city-label-group">
                                        <div class="city-label-title">ÊàëÁöÑ‰ΩçÁΩÆ<svg class="verified-icon"
                                                viewBox="0 0 24 24">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-user-fake" class="city-name-main">Êú™ËÆæÁΩÆ</div>
                                    </div>
                                </div>
                                <div id="ui-user-real" class="city-name-sub">Êò†Â∞Ñ: (Á©∫)</div>
                                <div id="ui-user-weather" class="city-weather-info">--</div>
                            </div>
                            <div class="city-card" onclick="openCityModal('char')">
                                <div class="city-card-header">
                                    <div class="city-icon-bg" style="background:#F4F4FF;"><svg viewBox="0 0 24 24"
                                            width="18" height="18" fill="#9B9ECE">
                                            <path
                                                d="M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z" />
                                        </svg></div>
                                    <div class="city-label-group">
                                        <div class="city-label-title">ÂØπÊñπ‰ΩçÁΩÆ<svg class="verified-icon"
                                                viewBox="0 0 24 24">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-char-fake" class="city-name-main">Êú™ËÆæÁΩÆ</div>
                                    </div>
                                </div>
                                <div id="ui-char-real" class="city-name-sub">Êò†Â∞Ñ: (Á©∫)</div>
                                <div id="ui-char-weather" class="city-weather-info">--</div>
                            </div>
                        </div>

                        <div id="view-mode-group" style="display:none; padding:16px;">
                            <div class="city-card-wide" onclick="openCityModal('user')">
                                <div class="city-card-header">
                                    <div class="city-label-group">
                                        <div class="city-label-title">ÊàëÁöÑÂΩìÂâç‰ΩçÁΩÆ (Áæ§ÂêåÊ≠•)<svg class="verified-icon"
                                                viewBox="0 0 24 24" style="margin-left:6px;">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-user-fake-group" class="city-name-main"
                                            style="font-size:18px; margin-top:2px;">Êú™ËÆæÁΩÆ</div>
                                    </div>
                                </div>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-top:8px; border-top:1px solid #f9f9f9; padding-top:8px;">
                                    <div id="ui-user-real-group" class="city-name-sub">Êò†Â∞Ñ: (Á©∫)</div>
                                    <div id="ui-user-weather-group" class="city-weather-info" style="color:#9B9ECE;">--
                                    </div>
                                </div>
                            </div>
                            <div style="font-size:12px; color:#999; margin:20px 0 10px 4px;">ÂÖ∂‰ªñÊàêÂëò‰ΩçÁΩÆ</div>
                            <div id="env-group-list-container"></div>
                        </div>

                        <div style="padding:15px; font-size:12px; color:#999; line-height:1.5; text-align:center;">
                            üí° Êò†Â∞ÑÁúüÂÆûÂüéÂ∏Ç‰ª•Ëé∑ÂèñÂÆûÊó∂Â§©Ê∞î
                        </div>
                    </div>
                </div>

                <div id="modal-wb-mount" class="modal-overlay" style="z-index: 310;">
                    <div class="modal-card">
                        <div class="close-modal"
                            onclick="document.getElementById('modal-wb-mount').style.display='none'">√ó
                        </div>
                        <h3 style="margin-top:0;">ÈÄâÊã©Â±ÄÈÉ®ËÆæÂÆö</h3>
                        <p style="font-size:12px;color:#999;margin-bottom:15px;">ÂãæÈÄâË¶ÅÊåÇËΩΩÂà∞ÂΩìÂâç‰ºöËØùÁöÑ‰∏ñÁïå‰π¶ (ÂÖ®Â±ÄËÆæÂÆöÈªòËÆ§ÁîüÊïà)</p>
                        <div id="wb-mount-list" style="max-height:300px; overflow-y:auto;"></div>
                        <button class="btn-main" onclick="saveWbMount()">‰øùÂ≠òÊåÇËΩΩ</button>
                    </div>
                </div>

            </div>

            <div id="sub-page-visual" class="sub-page" style="background: #F2F2F7;">
                <div class="app-header" style="background: #fff;">
                    <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                    <div class="header-content">
                        <div class="header-left" onclick="event.stopPropagation(); closeSubPage('visual')"
                            style="width: 40px; padding-left: 5px;">
                            <svg viewBox="0 0 24 24" width="28" height="28">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                        </div>
                        <div class="header-title"><span style="font-size:17px;font-weight:600;">Â§¥ÂÉè‰∏éÊòµÁß∞</span></div>
                        <div class="header-right" onclick="saveVisualSettings()"
                            style="width:40px; display:flex; justify-content:center;">
                            <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="app-body" style="padding-top: 10px;">
                    <div style="margin: 10px 0 8px 24px; font-size:13px; color:#888;">ÈÄâÊã©Ë¶Å‰øÆÊîπÁöÑÂØπË±°</div>

                    <div
                        style="background: #fff; border-radius: 12px; margin: 0 16px 20px 16px; padding: 15px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                        <div id="visual-target-container" class="visual-target-list" style="padding: 10px 16px;">
                        </div>
                    </div>

                    <div
                        style="background: #fff; border-radius: 12px; margin: 0 16px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">

                        <div style="display:flex; justify-content:center; margin-bottom:20px;">
                            <div style="position:relative;">
                                <div id="visual-preview"
                                    style="width:100px; height:100px; background:#eee; border-radius:50%; background-size:cover; background-position:center; border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                </div>
                                <div onclick="document.getElementById('visual-file-input').click()"
                                    style="position:absolute; bottom:0; right:0; width:32px; height:32px; background:var(--theme-purple); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; border:2px solid #fff; cursor:pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                                    <svg viewBox="0 0 24 24" width="18" height="18" fill="white">
                                        <path
                                            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                                    </svg>
                                </div>
                                <input type="file" id="visual-file-input" hidden accept="image/*"
                                    onchange="handleVisualAvatarFile(this)">
                            </div>
                        </div>

                        <div style="text-align:center; font-size:18px; font-weight:600; margin-bottom:25px; color:#333;"
                            id="visual-target-name">Êú™Áü•</div>

                        <label class="setting-label">ÊòæÁ§∫ÊòµÁß∞ (‰ªÖÂú®Êú¨‰ºöËØùÁîüÊïà)</label>
                        <div class="input-wrapper">
                            <input type="text" id="visual-alias-input" class="setting-input" placeholder="ÈªòËÆ§‰∏∫ÂéüÂêç">
                        </div>

                        <div class="setting-row" style="padding: 10px 0; border-bottom: 1px solid #f9f9f9;">
                            <div class="ios-text-box">
                                <div class="ios-title" style="font-size:15px;">Â§¥ÂÉèÂΩ¢Áä∂</div>
                            </div>
                            <div class="shape-selector">
                                <div id="shape-circle" class="shape-option active" onclick="setVisualShape('circle')">ÂúÜÂΩ¢
                                </div>
                                <div id="shape-square" class="shape-option" onclick="setVisualShape('square')">ÂúÜËßí</div>
                            </div>
                        </div>

                        <div class="setting-row" style="padding: 15px 0; border-bottom: 1px solid #f9f9f9;">
                            <div class="ios-text-box">
                                <div class="ios-title" style="font-size:15px;">Â§¥ÂÉèÂ§ßÂ∞è</div>
                            </div>
                            <div style="display:flex; align-items:center; width: 140px;">
                                <input type="range" id="visual-size-slider" class="morandi-slider" min="30" max="60"
                                    step="2" oninput="updateVisualSizeVal(this.value)">
                                <span id="visual-size-val"
                                    style="width:40px; text-align:right; font-size:12px; color:#888;">40px</span>
                            </div>
                        </div>

                        <div class="setting-row" style="padding: 10px 0; border-bottom: none;">
                            <div class="ios-text-box">
                                <div class="ios-title" style="font-size:15px;">ÊòæÁ§∫Â§¥ÂÉè</div>
                            </div>
                            <label class="ios-switch">
                                <input type="checkbox" id="visual-show-switch" checked
                                    onchange="toggleVisualVisibility(this)">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div style="padding:20px; text-align:center; color:#999; font-size:12px;">
                        ËÆæÁΩÆ‰ªÖÂØπÂΩìÂâçËÆæÂ§á‰∏äÁöÑÂΩìÂâç‰ºöËØùÁîüÊïà
                    </div>
                </div>
            </div>
        </div>

        <div id="modal-city-select" class="modal-overlay" style="z-index: 300;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-city-select').style.display='none'">√ó
                </div>
                <h3 style="margin-top:0;">ÂÆö‰ΩçËÆæÁΩÆ</h3>

                <label class="setting-label">ÊòæÁ§∫ÂêçÁß∞ (RoleplayÁî®)</label>
                <div class="input-wrapper">
                    <input type="text" id="city-fake-input" class="setting-input" placeholder="‰æãÂ¶ÇÔºöÂì•Ë∞≠Â∏Ç / È≠îÊ≥ïÂ≠¶Èô¢">
                </div>

                <label class="setting-label">ÁúüÂÆûÊò†Â∞ÑÂüéÂ∏Ç (APIÊü•ËØ¢Áî®)</label>
                <div class="input-wrapper">
                    <input type="text" id="city-real-input" class="setting-input"
                        placeholder="‰æãÂ¶ÇÔºöNew York / London / Beijing">
                </div>
                <p style="font-size:12px;color:#999;margin-bottom:15px;">ËØ∑Â°´ÂÜôËã±ÊñáÂüéÂ∏ÇÂêçÊàñÊãºÈü≥ (Â¶Ç Shanghai)Ôºå‰ª•‰æøAPIÂáÜÁ°ÆËØÜÂà´„ÄÇ</p>

                <button class="btn-main" onclick="saveCitySelection()">‰øùÂ≠òËÆæÂÆö</button>
            </div>
        </div>
        <div id="app-worldbook" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('worldbook')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">‰∏ñÁïå‰π¶</span></div>
                    <div class="header-right" style="gap:15px; padding-right:10px;">
                        <div id="wb-btn-select" onclick="toggleWbSelectMode()"
                            style="cursor:pointer; display:flex; color:var(--theme-purple);">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path
                                    d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z" />
                            </svg>
                        </div>
                        <div id="wb-btn-add" onclick="openWorldBookEdit()" style="cursor:pointer; display:flex;">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div style="flex-shrink: 0; padding: 10px 16px 0 16px; background: #F9F9FC; z-index: 10;">
                <div class="avatar-tabs" style="margin-bottom:10px;">
                    <div class="avatar-tab active" id="wb-tab-global" onclick="switchWorldBookTab('global')">ÂÖ®Â±ÄËÆæÂÆö</div>
                    <div class="avatar-tab" id="wb-tab-local" onclick="switchWorldBookTab('local')">Â±ÄÈÉ®ËÆæÂÆö</div>
                </div>

                <div id="wb-category-bar" class="category-scroll-container">
                </div>
            </div>

            <div class="app-body" style="padding: 0 16px;">
                <div id="worldbook-list-container" style="padding-bottom: 80px;"></div>
            </div>

            <div id="wb-bottom-bar" class="wb-bottom-bar">
                <div class="wb-bar-btn" onclick="openWbMoveModal()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="#666">
                        <path
                            d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z" />
                    </svg>
                    <span>ÁßªÂä®ÂàÜÁ±ª</span>
                </div>
                <div class="wb-bar-btn danger" onclick="batchDeleteWb()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#FF3B30" stroke-width="2">
                        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                    </svg>
                    <span>Âà†Èô§</span>
                </div>
            </div>
        </div>

        <div id="modal-cat-mgr" class="modal-overlay" style="z-index: 400;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-cat-mgr').style.display='none'">√ó</div>
                <h3 style="margin-top:0;">ÂàÜÁ±ªÁÆ°ÁêÜ</h3>

                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="new-cat-name" class="setting-input" placeholder="Êñ∞ÂàÜÁ±ªÂêçÁß∞"
                        style="height:40px; margin:0;">
                    <button class="btn-main" onclick="addNewCategory()"
                        style="width:80px; margin:0; padding:0;">Ê∑ªÂä†</button>
                </div>

                <div style="font-size:12px;color:#999;margin-bottom:8px;">Âà†Èô§ÂàÜÁ±ªÊó∂ÔºåÂÖ∂‰∏ãÂÜÖÂÆπ‰ºöËá™Âä®ÁßªÂÖ•ÈªòËÆ§ÂàÜÁ±ª</div>

                <div id="cat-mgr-list"
                    style="max-height:300px; overflow-y:auto; border:1px solid #f0f0f0; border-radius:12px;">
                </div>
            </div>
        </div>

        <div id="modal-wb-move" class="modal-overlay" style="z-index: 410;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-wb-move').style.display='none'">√ó</div>
                <h3>ÁßªÂä®Âà∞...</h3>
                <div id="move-cat-list" style="max-height:300px; overflow-y:auto;">
                </div>
            </div>
        </div>

        <div id="app-worldbook-edit" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('worldbook-edit')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>

                    <div class="header-title"><span id="wb-edit-title"
                            style="font-size:17px;font-weight:600;">ÁºñËæëËØçÊù°</span></div>

                    <div class="header-right"
                        style="width: auto; min-width: 40px; display: flex; align-items: center; justify-content: flex-end; gap: 16px; padding-right: 10px;">
                        <div id="btn-del-wb" onclick="deleteWorldBookEntry()"
                            style="display:none; cursor:pointer; padding: 4px;">
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="#B26B61"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </div>

                        <div onclick="saveWorldBookEntry()" style="cursor:pointer; display:flex;">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-body" style="padding: 20px 16px;">
                <div class="wb-edit-type-segment">
                    <div id="wb-edit-segment-global" class="wb-edit-segment-item active"
                        onclick="switchWbEditType('global')">ÂÖ®Â±ÄËÆæÂÆö</div>
                    <div id="wb-edit-segment-local" class="wb-edit-segment-item" onclick="switchWbEditType('local')">
                        Â±ÄÈÉ®ËÆæÂÆö</div>
                </div>
                <label class="setting-label">ËØçÊù°ÂêçÁß∞</label>
                <div class="input-wrapper">
                    <input type="text" id="wb-name" class="setting-input" placeholder="‰æãÂ¶ÇÔºöÈ≠îÊ≥ïÂéüÁêÜ / ÂÆ∂ÊóèÂéÜÂè≤">
                </div>
                <label class="setting-label">ÊâÄÂ±ûÂàÜÁ±ª</label>
                <div class="input-wrapper">
                    <select id="wb-category-select" class="setting-input" style="background-image:none;">
                    </select>
                </div>
                <label class="setting-label">Ëß¶ÂèëÊú∫Âà∂</label>
                <div class="settings-card" style="margin:0 0 16px 0;">
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>Â∏∏È©ªÊøÄÊ¥ª (Constant)</h4>
                            <p>Êó†ÈúÄËß¶ÂèëËØçÔºåÊ∞∏ËøúÊ≥®ÂÖ•Âà∞Prompt‰∏≠</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="wb-constant" onchange="toggleWbKeywords(this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div id="wb-keyword-group">
                    <label class="setting-label">Ëß¶ÂèëÂÖ≥ÈîÆËØç (Ëã±ÊñáÈÄóÂè∑ÂàÜÈöî)</label>
                    <div class="input-wrapper">
                        <input type="text" id="wb-keys" class="setting-input" placeholder="‰æãÂ¶ÇÔºöÈ≠îÊ≥ï, ÂêüÂî±, mana">
                    </div>
                </div>

                <label class="setting-label">ÂÜÖÂÆπËÆæÂÆö (Content)</label>
                <div class="input-wrapper">
                    <textarea id="wb-content" class="setting-input" style="height:150px; line-height:1.5;"
                        placeholder="ËæìÂÖ•ËØ•ËØçÊù°ÁöÑÂÖ∑‰ΩìËÆæÂÆöÂÜÖÂÆπ..."></textarea>
                </div>

                <label class="setting-label">È´òÁ∫ßÈÄâÈ°π</label>
                <div class="settings-card" style="margin:0;">
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>Ê≥®ÂÖ•‰ΩçÁΩÆ</h4>
                            <p>ÂΩ±ÂìçAIËÆ§Áü•ÁöÑ‰ºòÂÖàÁ∫ß</p>
                        </div>
                        <select id="wb-position"
                            style="border:none; bg:transparent; text-align:right; font-size:14px; color:#666;">
                            <option value="top">È°∂ÈÉ®</option>
                            <option value="bottom">Â∫ïÈÉ®</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>Ê≥®ÂÖ•ÊùÉÈáç (Order)</h4>
                            <p>Êï∞Â≠óË∂äÂ§ßË∂äÈù†Âêé</p>
                        </div>
                        <input type="number" id="wb-order" value="100"
                            style="width:50px; border:none; text-align:right;">
                    </div>
                </div>


            </div>
        </div>
        <div id="msg-context-menu-overlay" class="msg-menu-overlay" style="display: none;" onclick="hideMsgMenu()">
            <div id="msg-menu-box" class="msg-menu-box">
                <div class="msg-menu-item" onclick="handleCopyMsg()" style="justify-content: center;">
                    <span>Â§çÂà∂</span>
                </div>

                <div class="msg-menu-line"></div>

                <div class="msg-menu-item" onclick="handleDeleteMsg()" style="justify-content: center;">
                    <span>Âà†Èô§</span>
                </div>
            </div>
        </div>
        <div id="app-sticker-mgr" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('sticker-mgr')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">Ë°®ÊÉÖÂ∫ì</span></div>

                    <div class="header-right" style="gap:15px; padding-right:10px;">
                        <div id="st-btn-select" onclick="toggleStickerSelectMode()"
                            style="cursor:pointer; display:flex; color:var(--theme-purple);">
                            <svg class="icon-default" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path
                                    d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z" />
                            </svg>
                        </div>
                        <div id="st-btn-add" onclick="showAddStickerModal()" style="cursor:pointer; display:flex;">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <div style="flex-shrink: 0; padding: 10px 16px 0 16px; background: #F9F9FC; z-index: 10;">
                <div id="sticker-pack-bar" class="category-scroll-container"></div>
            </div>

            <div class="app-body" style="padding: 10px 16px;">
                <div id="sticker-grid-container" class="sticker-grid"></div>
            </div>

            <div id="st-bottom-bar" class="wb-bottom-bar">
                <div class="wb-bar-btn" onclick="openStickerMoveModal()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="#666">
                        <path
                            d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z" />
                    </svg>
                    <span>ÁßªÂä®Âà∞...</span>
                </div>
                <div class="wb-bar-btn" onclick="selectAllStickers()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="#666">
                        <path
                            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                    <span>ÂÖ®ÈÄâ</span>
                </div>
                <div class="wb-bar-btn danger" onclick="batchDeleteStickers()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#FF3B30" stroke-width="2">
                        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                    </svg>
                    <span>Âà†Èô§</span>
                </div>
            </div>

            <div id="modal-sticker-add" class="modal-overlay" style="z-index: 500;">
                <div class="modal-card"
                    style="display: flex; flex-direction: column; padding: 0; max-height: 85vh; overflow: hidden;">

                    <div style="padding: 20px 20px 0 20px; flex-shrink: 0; position: relative;">
                        <div class="close-modal"
                            onclick="document.getElementById('modal-sticker-add').style.display='none'"
                            style="top: 15px; right: 20px;">√ó</div>

                        <h3 style="margin-top:0;">ÁÆ°ÁêÜË°®ÊÉÖ</h3>

                        <div class="wb-edit-type-segment" style="margin-bottom:10px;">
                            <div id="st-tab-item" class="wb-edit-segment-item active"
                                onclick="switchStickerAddTab('item')">ÂçïÂº†</div>
                            <div id="st-tab-batch" class="wb-edit-segment-item" onclick="switchStickerAddTab('batch')">
                                ÊâπÈáè</div>
                            <div id="st-tab-backup" class="wb-edit-segment-item"
                                onclick="switchStickerAddTab('backup')">Â§á‰ªΩ</div>
                        </div>
                    </div>

                    <div
                        style="flex: 1; overflow-y: auto; padding: 10px 20px 20px 20px; -webkit-overflow-scrolling: touch;">

                        <div id="form-sticker-item">
                            <div style="display:flex; gap:15px; margin-bottom:15px; align-items:flex-start;">
                                <div style="flex-shrink:0; text-align:center;">
                                    <div id="st-upload-box" onclick="document.getElementById('st-file-input').click()"
                                        style="width:80px; height:80px; background:#f9f9f9; border:1px dashed #ccc; border-radius:12px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative;">
                                        <img id="st-preview" src=""
                                            style="width:100%; height:100%; object-fit:contain; display:none;">
                                        <div id="st-ph"
                                            style="color:#999; font-size:10px; display:flex; flex-direction:column; align-items:center;">
                                            <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc"
                                                style="margin-bottom:2px;">
                                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                            </svg>
                                            <span>‰∏ä‰º†</span>
                                        </div>
                                    </div>
                                    <input type="file" id="st-file-input" hidden accept="image/*"
                                        onchange="handleStickerFile(this)">
                                </div>
                                <div style="flex-grow:1;">
                                    <label class="setting-label" style="margin-bottom:6px; display:block;">Ë°®ÊÉÖÂêçÁß∞</label>
                                    <input type="text" id="st-item-name" class="setting-input" placeholder="Êú™ÂëΩÂêç"
                                        style="height:40px; font-size:14px; margin-bottom:8px;">
                                    <div style="font-size:11px; color:#aaa; line-height:1.4;">ÊîØÊåÅ JPG, PNG, GIF<br>Âª∫ËÆÆÂ∞∫ÂØ∏
                                        240x240</div>
                                </div>
                            </div>
                            <div style="background:#F9F9FC; border-radius:10px; padding:10px 12px; margin-bottom:15px;">
                                <div style="display:flex; align-items:center; margin-bottom:4px;">
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="#999"
                                        style="margin-right:4px;">
                                        <path
                                            d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                                    </svg>
                                    <span style="font-size:12px; color:#888; font-weight:500;">ÁΩëÁªúÂõæÁâáÈìæÊé• (ÂèØÈÄâ)</span>
                                </div>
                                <input type="text" id="st-url-input" class="setting-input"
                                    placeholder="Á≤òË¥¥‰ª• http ÂºÄÂ§¥ÁöÑÂõæÁâáÈìæÊé•" oninput="handleStickerUrl(this)"
                                    style="height:36px; font-size:13px; border:1px solid #eee; background:#fff; margin-bottom:0;">
                            </div>
                            <button class="btn-main" onclick="saveStickerItem()">‰øùÂ≠òÂà∞ÂΩìÂâçÂ∫ì</button>
                        </div>

                        <div id="form-sticker-batch" style="display:none;">
                            <label class="setting-label">ÊâπÈáèÊñáÊú¨ (Ê†ºÂºèÔºöÂêçÁß∞: ÈìæÊé•)</label>
                            <div class="input-wrapper">
                                <textarea id="st-batch-input" class="setting-input"
                                    style="height:150px; line-height:1.4; font-size:13px; white-space:pre-wrap; word-break:break-all; overflow-y:auto;"
                                    placeholder="‰æãÂ¶ÇÔºö&#10;ÂºÄÂøÉ: http://example.com/1.jpg&#10;ÈöæËøá: http://example.com/2.jpg"></textarea>
                            </div>
                            <button class="btn-main" onclick="saveStickerBatch()">ÂºÄÂßãÊâπÈáèÂØºÂÖ•</button>
                        </div>

                        <div id="form-sticker-backup" style="display:none; padding-top:10px;">
                            <div onclick="exportCurrentPack()"
                                style="display:flex; align-items:center; background:#F9F9FC; padding:12px 16px; border-radius:12px; margin-bottom:10px; cursor:pointer; border:1px solid #f0f0f0;">
                                <div
                                    style="width:36px; height:36px; background:#fff; border-radius:10px; display:flex; align-items:center; justify-content:center; margin-right:12px; flex-shrink:0; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                                    <svg viewBox="0 0 24 24" width="20" height="20" fill="#9B9ECE">
                                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                                    </svg>
                                </div>
                                <div style="flex-grow:1;">
                                    <div style="font-size:15px; font-weight:600; color:#333;">ÂØºÂá∫ÂΩìÂâçË°®ÊÉÖÂ∫ì</div>
                                    <div style="font-size:12px; color:#999;">ÁîüÊàê .json Â§á‰ªΩÊñá‰ª∂</div>
                                </div>
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#ccc">
                                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                                </svg>
                            </div>

                            <div
                                style="position:relative; display:flex; align-items:center; background:#F9F9FC; padding:12px 16px; border-radius:12px; margin-bottom:10px; cursor:pointer; border:1px solid #f0f0f0;">
                                <input type="file" id="json-import-input" accept=".json"
                                    onchange="importStickerPack(this)"
                                    style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer;">
                                <div
                                    style="width:36px; height:36px; background:#fff; border-radius:10px; display:flex; align-items:center; justify-content:center; margin-right:12px; flex-shrink:0; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                                    <svg viewBox="0 0 24 24" width="20" height="20" fill="#9B9ECE">
                                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                                    </svg>
                                </div>
                                <div style="flex-grow:1;">
                                    <div style="font-size:15px; font-weight:600; color:#333;">ÂØºÂÖ•Ë°®ÊÉÖÂ∫ì</div>
                                    <div style="font-size:12px; color:#999;">ËØªÂèñ .json ËøòÂéüÊï∞ÊçÆ</div>
                                </div>
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="#ccc">
                                    <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                                </svg>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div id="modal-sticker-move" class="modal-overlay" style="z-index: 510;">
                <div class="modal-card">
                    <div class="close-modal"
                        onclick="document.getElementById('modal-sticker-move').style.display='none'">√ó</div>
                    <h3>ÁßªÂä®Âà∞...</h3>
                    <div id="st-move-list" style="max-height:300px; overflow-y:auto;"></div>
                </div>
            </div>

            <div id="sticker-preview-overlay" class="preview-overlay" onclick="this.style.display='none'">
                <img id="sticker-preview-img" src="">
                <div style="color:white; margin-top:20px; font-size:14px; opacity:0.8;">ÁÇπÂáª‰ªªÊÑèÂ§ÑÂÖ≥Èó≠</div>
            </div>
        </div>
        <div id="modal-st-pack-mgr" class="modal-overlay" style="z-index: 600;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-st-pack-mgr').style.display='none'">√ó
                </div>
                <h3 style="margin-top:0;">ÁÆ°ÁêÜË°®ÊÉÖÂ∫ì</h3>

                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="quick-pack-name" class="setting-input" placeholder="Êñ∞ÂàÜÁ±ªÂêçÁß∞"
                        style="height:40px; margin:0;">
                    <button class="btn-main" onclick="quickAddStickerPack()"
                        style="width:80px; margin:0; padding:0;">Ê∑ªÂä†</button>
                </div>

                <div style="font-size:12px;color:#999;margin-bottom:8px;">ÁÇπÂáªÂè≥‰æßÂõæÊ†áÂà†Èô§ÂàÜÁ±ª (‰∏çÂèØÊÅ¢Â§ç)</div>

                <div id="st-pack-mgr-list" style="
    max-height: 50vh; 
    overflow-y: auto; 
    border: 1px solid #f0f0f0; 
    border-radius: 12px;
    margin-top: 10px;
">
                </div>
            </div>
        </div>
        <div id="modal-voice-input" class="modal-overlay" style="z-index: 700;">
            <div class="modal-card" style="padding: 0; overflow: hidden;">

                <div style="padding: 24px 24px 0 24px; position: relative; background: #fff; z-index: 10;">
                    <div class="close-modal" onclick="document.getElementById('modal-voice-input').style.display='none'"
                        style="top: 20px; right: 20px;">√ó</div>

                    <h3 style="margin-top:0;">ÂΩïÂà∂ËØ≠Èü≥</h3>
                </div>

                <div
                    style="flex: 1; overflow-y: auto; padding: 20px 24px 24px 24px; -webkit-overflow-scrolling: touch;">

                    <div style="display:flex; flex-direction:column; align-items:center; margin-bottom: 20px;">
                        <div
                            style="width:60px; height:60px; background:#9B9ECE; border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 15px rgba(155, 158, 206, 0.4);">
                            <svg viewBox="0 0 24 24" width="30" height="30" fill="white">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.66 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </div>
                        <div style="font-size:12px; color:#999; margin-top:10px;">ËØ≠Èü≥ËΩ¨ÊñáÂ≠ó‰∏≠...</div>
                    </div>

                    <label class="setting-label">ËØÜÂà´ÂÜÖÂÆπ</label>
                    <div class="input-wrapper">
                        <textarea id="voice-text-input" class="setting-input" style="height:80px; padding-top:10px;"
                            placeholder="ÁÇπÂáªÊ≠§Â§ÑÁºñËæëËØ≠Èü≥ÂÜÖÂÆπ..."></textarea>
                    </div>

                    <button class="btn-main" onclick="submitVoiceInput()" style="background:#9B9ECE;">ÂèëÈÄÅËØ≠Èü≥</button>
                </div>

            </div>
        </div>
        <div id="modal-photo-card" class="modal-overlay" style="z-index: 750;">
            <div class="modal-card"
                style="padding: 0; display: flex; flex-direction: column; overflow: hidden; max-height: 85vh;">

                <div
                    style="padding: 20px 20px 0 20px; flex-shrink: 0; position: relative; background: #fff; z-index: 10;">
                    <div class="close-modal" onclick="document.getElementById('modal-photo-card').style.display='none'"
                        style="top: 15px; right: 20px;">√ó</div>

                    <h3 style="margin-top:0; margin-bottom: 15px;">ÂèëÈÄÅÂÜÖÂÆπ</h3>

                    <div class="wb-edit-type-segment" style="margin-bottom:10px;">
                        <div id="tab-photo-local" class="wb-edit-segment-item active" onclick="switchPhotoTab('local')">
                            Êú¨Âú∞ÂõæÁâá</div>
                        <div id="tab-photo-card" class="wb-edit-segment-item" onclick="switchPhotoTab('card')">ÂõæÊñáÂç°Áâá
                        </div>
                    </div>
                </div>

                <div
                    style="flex: 1; overflow-y: auto; padding: 10px 20px 20px 20px; -webkit-overflow-scrolling: touch;">

                    <div id="panel-photo-local">
                        <div onclick="document.getElementById('inp-local-img').click()"
                            style="width:100%; height:140px; background:#f9f9f9; border:2px dashed #eee; border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; position:relative;">

                            <img id="preview-local-img"
                                style="width:100%; height:100%; object-fit:contain; display:none;">

                            <div id="placeholder-local-img"
                                style="display:flex; flex-direction:column; align-items:center; color:#ccc;">
                                <svg viewBox="0 0 24 24" width="30" height="30" fill="#ddd">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                </svg>
                                <span style="font-size:12px; margin-top:6px;">ÁÇπÂáªÈÄâÊã©ÂõæÁâá</span>
                            </div>
                        </div>
                        <input type="file" id="inp-local-img" hidden accept="image/*"
                            onchange="handleLocalImgFile(this)">
                        <p style="font-size:12px; color:#999; margin-top:8px; text-align:center;">AI Â∞ÜÂú®ÂõûÂ§çÊó∂ËØÜÂà´ËøôÂº†ÂõæÁâá</p>
                    </div>

                    <div id="panel-photo-card" style="display:none;">
                        <div style="display:flex; justify-content:center; margin: 10px 0;">
                            <img src="https://file.icve.com.cn/file_doc/qdqqd/2161767359654214.jpeg"
                                style="width:100px; height:100px; border-radius:12px; object-fit:cover;">
                        </div>
                        <label class="setting-label">Âç°ÁâáÈöêËóèÂÜÖÂÆπ</label>
                        <div class="input-wrapper">
                            <textarea id="photo-card-desc" class="setting-input"
                                style="height:80px; padding-top:10px; line-height:1.5;"
                                placeholder="ËæìÂÖ•ËøôÊÆµÊñáÂ≠óÔºåÂè™ÊúâÁÇπÂáªÂõæÁâáÂêéÊâçËÉΩÁúãÂà∞..."></textarea>
                        </div>
                    </div>

                    <button class="btn-main" onclick="submitPhotoUnified()" style="margin-top:15px;">ÂèëÈÄÅ</button>
                    <div style="height: 20px;"></div>
                </div>
            </div>
        </div>

        <div id="modal-card-detail" class="modal-overlay" style="z-index: 800; align-items: center;">
            <div class="modal-card" style="background: #fff; text-align: center; padding: 30px 20px;">
                <div class="close-modal" onclick="document.getElementById('modal-card-detail').style.display='none'">√ó
                </div>

                <div
                    style="width:60px; height:60px; background:#F4F4FF; border-radius:50%; margin:0 auto 20px auto; display:flex; align-items:center; justify-content:center;">
                    <svg viewBox="0 0 24 24" width="30" height="30" fill="#9B9ECE">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" />
                    </svg>
                </div>

                <h3 style="margin:0 0 10px 0; color:#333;">ËØ¶ÁªÜÂÜÖÂÆπ</h3>
                <p id="card-detail-text"
                    style="font-size:15px; color:#555; line-height:1.6; text-align: left; background: #F9F9FC; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                </p>

                <button class="btn-main" onclick="document.getElementById('modal-card-detail').style.display='none'"
                    style="background:#f0f0f0; color:#666;">ÂÖ≥Èó≠</button>
            </div>
        </div>
        <div id="global-image-viewer" class="preview-overlay" onclick="this.style.display='none'">
            <img id="global-image-viewer-img" src="" onclick="event.stopPropagation()">
            <div class="viewer-close-btn" onclick="document.getElementById('global-image-viewer').style.display='none'">
                √ó</div>
        </div>
    </div>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="js/db.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>

</body>

</html>