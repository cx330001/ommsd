<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes" />
    <title>sisi</title>
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon"
        href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0f2f5">
</head>

<body>

    <div id="phone-screen">
        <div id="home-screen">
            <div id="desktop-app-container">
                <div class="desktop-app-icon" onclick="openApp('chat')">
                    <div class="icon-bg-desktop" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="36" height="36" fill="white">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                        </svg>
                    </div>
                    <span class="label">WeChat</span>
                </div>
                <div class="desktop-app-icon" onclick="openApp('settings')">
                    <div class="icon-bg-desktop" style="background: #ffffff;">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="#9B9ECE">
                            <path
                                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                        </svg>
                    </div>
                    <span class="label">设置</span>
                </div>
            </div>
        </div>
        <div id="app-settings" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('settings')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>

                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">设置</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body">
                <div class="setting-group">
                    <div class="setting-row" onclick="openSubPage('api')">
                        <span class="setting-row-title">API 设置</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                    <div class="setting-row">
                        <span class="setting-row-title">通用</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>
                <div style="padding:20px; text-align:center; color:#ccc; font-size:12px;">
                    Version 1.0.0
                </div>
            </div>

            <div id="sub-page-api" class="sub-page">
                <div class="app-header">
                    <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                    <div class="header-content">
                        <div class="header-left" onclick="closeSubPage('api')" style="width: 40px; padding-left: 5px;">
                            <svg viewBox="0 0 24 24" width="28" height="28">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                        </div>
                        <div class="header-title"><span style="font-size:17px;font-weight:600;">API 配置</span></div>
                        <div class="header-right" style="width:40px;"></div>
                    </div>
                </div>

                <div class="app-body" style="padding: 20px 16px;">
                    <label class="setting-label">API 厂商</label>
                    <div class="input-wrapper">
                        <select id="api-provider" class="setting-input" style="background-image:none;"
                            onchange="toggleApiProvider(this.value)">
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="google">Google (Gemini)</option>
                        </select>
                    </div>
                    <label class="setting-label">API Base URL (选填)</label>
                    <div class="input-wrapper">
                        <input type="text" id="api-host" class="setting-input" placeholder="https://api.openai.com/v1">
                    </div>

                    <label class="setting-label">API Key (多Key请用英文逗号分隔)</label>
                    <div class="input-wrapper">
                        <input type="password" id="api-key" class="setting-input"
                            placeholder="sk-aaa, sk-bbb, sk-ccc...">
                    </div>

                    <label class="setting-label">模型选择</label>
                    <div class="model-selector-box">
                        <div id="current-model-text" class="model-display" onclick="toggleModelList()">
                            未选择模型
                        </div>
                        <div class="fetch-btn" onclick="fetchModels(event)">
                            <svg id="fetch-icon" viewBox="0 0 24 24" width="20" height="20" fill="#9B9ECE">
                                <path
                                    d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                            </svg>
                        </div>
                    </div>

                    <div id="model-list-container" class="model-dropdown"></div>

                    <div style="margin-top: 30px;">
                        <button class="btn-main" onclick="manualSaveApi()">保存配置</button>
                    </div>

                </div>
            </div>
        </div>
        <div id="app-chat" class="app-window">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('chat')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="app-title-text">消息</span></div>

                    <div id="btn-add-contact" class="header-right" onclick="openContactModal()" style="display:none;">
                        <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body">
                <div id="tab-msgs" class="tab-content active">
                    <div id="msg-list"></div>
                </div>

                <div id="tab-contacts" class="tab-content">
                    <div class="contact-item">
                        <div class="avatar" style="background:#E8C1C6">★</div>
                        <div class="chat-info">
                            <h4>特别关心</h4>
                        </div>
                    </div>
                    <div class="contact-item">
                        <div class="avatar" style="background:#A0C1B8">G</div>
                        <div class="chat-info">
                            <h4>群聊小组</h4>
                        </div>
                    </div>
                </div>

                <div id="tab-moment" class="tab-content">
                    <div class="menu-item">
                        <div class="avatar" style="width:30px; height:30px; background:none;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="#E8C1C6">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                            </svg>
                        </div>
                        <div class="chat-info">
                            <h4>朋友圈</h4>
                        </div>
                    </div>
                </div>

                <div id="tab-me" class="tab-content">
                    <div id="me-content-placeholder"></div>
                </div>
            </div>

            <div class="app-tabbar">
                <div class="tab-item active" onclick="switchTab('msgs', this)">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                    </svg>
                    <span>消息</span>
                </div>
                <div class="tab-item" onclick="switchTab('contacts', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                    </svg><span>好友</span>
                </div>
                <div class="tab-item" onclick="switchTab('moment', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z" />
                    </svg><span>发现</span>
                </div>
                <div class="tab-item" onclick="switchTab('me', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg><span>我</span>
                </div>
            </div>
        </div>
        <div id="app-conversation" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('conversation')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title conversation-header">
                        <span id="chat-title-text">聊天</span>
                        <!-- 新增状态栏 -->
                        <div class="status-container">
                            <span id="chat-status-dot" class="status-dot"></span>
                            <span id="chat-status-text">离线</span>
                        </div>
                    </div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body" id="chat-body" style="padding-bottom: 70px; background: #F9F9FC;">
            </div>

            <div class="chat-footer">
                <div class="icon-btn">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </div>

                <input type="text" class="chat-input" placeholder="输入消息..." />

                <div class="icon-btn">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path
                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
                    </svg>
                </div>

                <div class="icon-btn ai-send-btn">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                        <path
                            d="M21.435 2.582a1.933 1.933 0 00-1.93-.503L3.408 6.759a1.92 1.92 0 00-1.384 1.522c-.142.75.355 1.704 1.003 2.102l5.033 3.094 2.054 3.83c.21.39.426.779.803.957.25.119.531.149.789.043.435-.178.68-.621.844-1.049l.643-1.685 4.095 2.517c.504.31.956.276 1.342-.037.456-.37.648-.96.721-1.536l2.365-11.87a1.986 1.986 0 00-.281-1.666zM18.89 5.385l-8.55 7.684-1.748-1.075 10.298-6.609z" />
                    </svg>
                </div>
            </div>
        </div>

        <div id="modal-select-me" class="modal-overlay">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-select-me').style.display='none'">×
                </div>
                <h3 style="margin-top:0;">我是谁？</h3>
                <p style="color:#999; font-size:12px; margin-bottom:15px;">请选择你要使用的身份面具</p>
                <div id="persona-select-list" style="max-height:250px; overflow-y:auto;"></div>
            </div>
        </div>

        <div id="modal-persona" class="modal-overlay">
            <div class="modal-card">
                <div class="close-modal" onclick="closeModal()">×</div>
                <h3 style="margin-top:0;">切换身份</h3>

                <div id="persona-list-view">
                    <div id="persona-list" style="max-height:200px; overflow-y:auto;"></div>
                    <button class="btn-main" onclick="showAddForm()">+ 新建身份</button>
                </div>

                <div id="persona-add-view" style="display:none;">
                    <div style="text-align:center; margin-bottom:15px;">
                        <div class="avatar-tabs">
                            <div class="avatar-tab active" id="tab-file" onclick="toggleAvatarMode('file')">本地上传</div>
                            <div class="avatar-tab" id="tab-url" onclick="toggleAvatarMode('url')">URL链接</div>
                        </div>
                        <div id="input-group-file" class="avatar-upload"
                            onclick="document.getElementById('file-input').click()"
                            style="width:70px;height:70px;background:#f0f0f0;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:2px dashed #ccc;">
                            <img id="preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                            <span id="ph-file" style="font-size:10px;color:#999;">点击上传</span>
                        </div>
                        <input type="file" id="file-input" hidden accept="image/*" onchange="handleFile(this)">

                        <div id="input-group-url" style="display:none;">
                            <input type="text" id="url-input" class="input-style" placeholder="粘贴图片链接..."
                                oninput="handleUrl(this)">
                            <div
                                style="width:70px;height:70px;background:#f0f0f0;border-radius:50%;margin:10px auto;overflow:hidden;">
                                <img id="preview-url" src=""
                                    style="width:100%;height:100%;object-fit:cover;display:none;">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" id="inp-name" class="input-style" placeholder="昵称 (如: 小可爱)">
                        <input type="text" id="inp-id" class="input-style" placeholder="ID (如: 9527)">
                        <textarea id="inp-desc" class="input-style" placeholder="写点什么人设描述吧..."></textarea>
                    </div>

                    <button class="btn-main" onclick="savePersona()">保存</button>
                    <button class="btn-sec" onclick="hideAddForm()">返回</button>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-add-friend" class="modal-overlay">
        <div class="modal-card">
            <div class="close-modal" onclick="closeContactModal()">×</div>
            <h3 style="margin-top:0;">添加好友</h3>

            <div style="text-align:center; margin-bottom:15px;">
                <div class="avatar-tabs">
                    <div class="avatar-tab active" id="tab-c-file" onclick="toggleContactMode('file')">本地上传</div>
                    <div class="avatar-tab" id="tab-c-url" onclick="toggleContactMode('url')">URL链接</div>
                </div>

                <div id="c-input-group-file" class="avatar-upload"
                    onclick="document.getElementById('c-file-input').click()"
                    style="width:70px;height:70px;background:#f0f0f0;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:2px dashed #ccc;">
                    <img id="c-preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                    <span id="c-ph-file" style="font-size:10px;color:#999;">点击上传</span>
                </div>
                <input type="file" id="c-file-input" hidden accept="image/*" onchange="handleContactFile(this)">

                <div id="c-input-group-url" style="display:none;">
                    <input type="text" id="c-url-input" class="input-style" placeholder="粘贴图片链接..."
                        oninput="handleContactUrl(this)">
                    <div
                        style="width:70px;height:70px;background:#f0f0f0;border-radius:50%;margin:10px auto;overflow:hidden;">
                        <img id="c-preview-url" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <input type="text" id="c-inp-name" class="input-style" placeholder="好友昵称">
                <input type="text" id="c-inp-id" class="input-style" placeholder="ID号">
                <textarea id="c-inp-desc" class="input-style" placeholder="备注或描述..."></textarea>
            </div>

            <button class="btn-main" onclick="saveContact()">确认添加</button>
        </div>
    </div>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="js/db.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>

</body>

</html>