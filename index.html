<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes" />
    <title>sisi</title>
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon"
        href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0f2f5">
</head>

<body>

    <div id="phone-screen">
        <div id="home-screen">
            <div id="desktop-app-container">
                <div class="desktop-app-icon" onclick="openApp('chat')">
                    <div class="icon-bg-desktop" style="background: #9B9ECE;">
                        <svg viewBox="0 0 24 24" width="36" height="36" fill="white">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                        </svg>
                    </div>
                    <span class="label">WeChat</span>
                </div>
                <div class="desktop-app-icon" onclick="openApp('settings')">
                    <div class="icon-bg-desktop" style="background: #ffffff;">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="#9B9ECE">
                            <path
                                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                        </svg>
                    </div>
                    <span class="label">设置</span>
                </div>
                <div class="desktop-app-icon" onclick="openApp('worldbook')">
                    <div class="icon-bg-desktop" style="background: #E8C1C6;">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="white">
                            <path
                                d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" />
                        </svg>
                    </div>
                    <span class="label">世界书</span>
                </div>
            </div>
        </div>
        <div id="app-settings" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('settings')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>

                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">设置</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body">
                <div class="setting-group">
                    <div class="setting-row" onclick="openSubPage('api')">
                        <span class="setting-row-title">API 设置</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                    <div class="setting-row">
                        <span class="setting-row-title">通用</span>
                        <svg class="setting-row-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>
                <div style="padding:20px; text-align:center; color:#ccc; font-size:12px;">
                    Version 1.0.0
                </div>
            </div>

            <div id="sub-page-api" class="sub-page">
                <div class="app-header">
                    <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                    <div class="header-content">
                        <div class="header-left" onclick="closeSubPage('api')" style="width: 40px; padding-left: 5px;">
                            <svg viewBox="0 0 24 24" width="28" height="28">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                        </div>
                        <div class="header-title"><span style="font-size:17px;font-weight:600;">API 配置</span></div>
                        <div class="header-right" style="width:40px;"></div>
                    </div>
                </div>

                <div class="app-body" style="padding: 20px 16px;">
                    <label class="setting-label">API 厂商</label>
                    <div class="input-wrapper">
                        <select id="api-provider" class="setting-input" style="background-image:none;"
                            onchange="toggleApiProvider(this.value)">
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="google">Google (Gemini)</option>
                        </select>
                    </div>
                    <label class="setting-label">API Base URL (选填)</label>
                    <div class="input-wrapper">
                        <input type="text" id="api-host" class="setting-input" placeholder="https://api.openai.com/v1">
                    </div>

                    <label class="setting-label">API Key (多Key请用英文逗号分隔)</label>
                    <div class="input-wrapper">
                        <input type="password" id="api-key" class="setting-input"
                            placeholder="sk-aaa, sk-bbb, sk-ccc...">
                    </div>

                    <label class="setting-label">模型选择</label>
                    <div class="model-selector-box">
                        <div id="current-model-text" class="model-display" onclick="toggleModelList()">
                            未选择模型
                        </div>
                        <div class="fetch-btn" onclick="fetchModels(event)">
                            <svg id="fetch-icon" viewBox="0 0 24 24" width="20" height="20" fill="#9B9ECE">
                                <path
                                    d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                            </svg>
                        </div>
                    </div>

                    <div id="model-list-container" class="model-dropdown"></div>
                    <label class="setting-label" style="margin-top: 20px;">
                        温度 (创造性): <span id="temp-display" style="color:#9B9ECE; font-weight:bold;">0.7</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="range" id="api-temp" style="width:100%;" min="0" max="2" step="0.1" value="0.7"
                            oninput="document.getElementById('temp-display').innerText = this.value">
                    </div>


                    <div style="margin-top: 30px;">
                        <button class="btn-main" onclick="manualSaveApi()">保存配置</button>
                    </div>

                </div>
            </div>
        </div>
        <div id="app-chat" class="app-window">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('chat')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="app-title-text">消息</span></div>

                    <div id="btn-add-contact" class="header-right" onclick="openContactPage()" style="display:none;">
                        <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body">
                <div id="tab-msgs" class="tab-content active">
                    <div id="msg-list"></div>
                </div>

                <div id="tab-contacts" class="tab-content">

                    <div class="menu-item" onclick="openGroupCreateUI()"
                        style="margin: 16px 16px 10px 16px; height: 70px; box-sizing: border-box;">
                        <div class="avatar"
                            style="width:40px; height:40px; background:#9B9ECE; display:flex; align-items:center; justify-content:center;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </div>
                        <div class="chat-info" style="flex-grow:1;">
                            <h4 style="margin:0;">发起群聊</h4>
                            <p style="margin:0; font-size:12px; color:#999;">创建一个新的多人会话</p>
                        </div>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                    <div id="contact-list-dynamic"></div>
                </div>

                <div id="tab-moment" class="tab-content">
                    <div class="menu-item">
                        <div class="avatar" style="width:30px; height:30px; background:none;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="#E8C1C6">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" />
                            </svg>
                        </div>
                        <div class="chat-info">
                            <h4>朋友圈</h4>
                        </div>
                    </div>
                </div>

                <div id="tab-me" class="tab-content">
                    <div id="me-content-placeholder"></div>
                </div>
            </div>

            <div class="app-tabbar">
                <div class="tab-item active" onclick="switchTab('msgs', this)">
                    <svg viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                    </svg>
                    <span>消息</span>
                </div>
                <div class="tab-item" onclick="switchTab('contacts', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                    </svg><span>好友</span>
                </div>
                <div class="tab-item" onclick="switchTab('moment', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z" />
                    </svg><span>发现</span>
                </div>
                <div class="tab-item" onclick="switchTab('me', this)">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg><span>我</span>
                </div>
            </div>
        </div>
        <div id="app-conversation" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('conversation')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title conversation-header">
                        <span id="chat-title-text">聊天</span>
                        <div class="status-container">
                            <span id="chat-status-dot" class="status-dot"></span>
                            <span id="chat-status-text">离线</span>
                        </div>
                    </div>
                    <div class="header-right" onclick="openChatSettings()"
                        style="width:40px; display:flex; justify-content:center;">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="#9B9ECE">
                            <path
                                d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body" id="chat-body" style="padding-bottom: 70px; background: #F9F9FC;">
            </div>

            <div class="chat-footer">
                <div class="icon-btn">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </div>

                <input type="text" class="chat-input" placeholder="输入消息..." />

                <div class="icon-btn">
                    <svg viewBox="0 0 24 24" width="28" height="28" fill="#9B9ECE">
                        <path
                            d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z" />
                    </svg>
                </div>

                <div class="icon-btn ai-send-btn" onclick="triggerAIResponse(this)">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                        <path
                            d="M21.435 2.582a1.933 1.933 0 00-1.93-.503L3.408 6.759a1.92 1.92 0 00-1.384 1.522c-.142.75.355 1.704 1.003 2.102l5.033 3.094 2.054 3.83c.21.39.426.779.803.957.25.119.531.149.789.043.435-.178.68-.621.844-1.049l.643-1.685 4.095 2.517c.504.31.956.276 1.342-.037.456-.37.648-.96.721-1.536l2.365-11.87a1.986 1.986 0 00-.281-1.666zM18.89 5.385l-8.55 7.684-1.748-1.075 10.298-6.609z" />
                    </svg>
                </div>
            </div>
        </div>

        <div id="modal-select-me" class="modal-overlay">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-select-me').style.display='none'">×
                </div>
                <h3 style="margin-top:0;">我是谁？</h3>
                <p style="color:#999; font-size:12px; margin-bottom:15px;">请选择你要使用的身份面具</p>
                <div id="persona-select-list" style="max-height:250px; overflow-y:auto;"></div>
            </div>
        </div>

        <div id="app-persona-mgr" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="handlePersonaBack()">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="persona-page-title"
                            style="font-size:17px;font-weight:600;">我的身份</span></div>
                    <div id="btn-add-persona" class="header-right" onclick="showPersonaForm()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="#9B9ECE">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                        </svg>
                    </div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <div id="view-persona-list">
                    <p style="font-size:12px;color:#999;margin-bottom:15px;text-align:center;">点击卡片切换当前使用的身份</p>
                    <div id="persona-list-container">
                    </div>
                </div>

                <div id="view-persona-form" style="display:none;">
                    <div style="text-align:center; margin-bottom:25px;">
                        <div class="avatar-tabs">
                            <div class="avatar-tab active" id="tab-file" onclick="toggleAvatarMode('file')">本地上传</div>
                            <div class="avatar-tab" id="tab-url" onclick="toggleAvatarMode('url')">URL链接</div>
                        </div>

                        <div id="input-group-file" class="avatar-upload"
                            onclick="document.getElementById('file-input').click()"
                            style="width:80px;height:80px;background:#fff;border-radius:20px;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #eee;box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                            <img id="preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                            <span id="ph-file"
                                style="font-size:12px;color:#999;display:flex;flex-direction:column;align-items:center;">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc" style="margin-bottom:4px;">
                                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                </svg>
                                上传
                            </span>
                        </div>
                        <input type="file" id="file-input" hidden accept="image/*" onchange="handleFile(this)">

                        <div id="input-group-url" style="display:none; margin-top:10px;">
                            <input type="text" id="url-input" class="setting-input" placeholder="粘贴图片链接..."
                                oninput="handleUrl(this)">
                            <div
                                style="width:80px;height:80px;background:#fff;border-radius:20px;margin:15px auto 0;overflow:hidden;border:1px solid #eee;">
                                <img id="preview-url" src=""
                                    style="width:100%;height:100%;object-fit:cover;display:none;">
                            </div>
                        </div>
                    </div>

                    <label class="setting-label">姓名</label>
                    <div class="input-wrapper">
                        <input type="text" id="inp-name" class="setting-input" placeholder="你的名字">
                    </div>

                    <label class="setting-label">人设描述</label>
                    <div class="input-wrapper">
                        <textarea id="inp-desc" class="setting-input"
                            style="height:120px; padding-top:12px; line-height:1.5;"
                            placeholder="写点什么人设描述吧..."></textarea>
                    </div>

                    <label class="setting-label">人际关系网</label>
                    <div id="me-relation-container" class="relation-list"
                        style="background:#fff; border:1px solid #eee;">
                        <div class="btn-add-relation" onclick="openRelationSelector('me')">+</div>
                    </div>

                    <div style="height:40px;"></div>
                    <button class="btn-main" onclick="savePersona()"
                        style="box-shadow: 0 5px 15px rgba(155, 158, 206, 0.4);">保存身份</button>
                    <div style="height:30px;"></div>
                </div>
            </div>
        </div>

        <div id="btn-add-contact" class="header-right" onclick="openContactPage()" style="display:none;">
            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
        </div>

        <div id="app-contact-edit" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeContactPage()">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span id="contact-page-title"
                            style="font-size:17px;font-weight:600;">添加好友</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <div style="text-align:center; margin-bottom:25px;">
                    <div class="avatar-tabs">
                        <div class="avatar-tab active" id="tab-c-file" onclick="toggleContactMode('file')">本地上传</div>
                        <div class="avatar-tab" id="tab-c-url" onclick="toggleContactMode('url')">URL链接</div>
                    </div>

                    <div id="c-input-group-file" class="avatar-upload"
                        onclick="document.getElementById('c-file-input').click()"
                        style="width:80px;height:80px;background:#fff;border-radius:20px;margin:0 auto;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #eee;box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                        <img id="c-preview-file" src="" style="width:100%;height:100%;object-fit:cover;display:none;">
                        <span id="c-ph-file"
                            style="font-size:12px;color:#999;display:flex;flex-direction:column;align-items:center;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="#ccc" style="margin-bottom:4px;">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                            上传
                        </span>
                    </div>
                    <input type="file" id="c-file-input" hidden accept="image/*" onchange="handleContactFile(this)">

                    <div id="c-input-group-url" style="display:none; margin-top:10px;">
                        <input type="text" id="c-url-input" class="setting-input" placeholder="粘贴图片链接..."
                            oninput="handleContactUrl(this)">
                        <div
                            style="width:80px;height:80px;background:#fff;border-radius:20px;margin:15px auto 0;overflow:hidden;border:1px solid #eee;">
                            <img id="c-preview-url" src=""
                                style="width:100%;height:100%;object-fit:cover;display:none;">
                        </div>
                    </div>
                </div>

                <label class="setting-label">姓名 / 昵称</label>
                <div class="input-wrapper">
                    <input type="text" id="c-inp-name" class="setting-input" placeholder="给TA起个名字">
                </div>

                <label class="setting-label">人设描述 / 备注</label>
                <div class="input-wrapper">
                    <textarea id="c-inp-desc" class="setting-input"
                        style="height:120px; padding-top:12px; line-height:1.5;"
                        placeholder="输入详细的人设描述、性格特征或备注信息..."></textarea>
                </div>

                <label class="setting-label">人际关系网</label>
                <div id="contact-relation-container" class="relation-list"
                    style="background:#fff; border:1px solid #eee;">
                    <div class="btn-add-relation" onclick="openRelationSelector('contact')">+</div>
                </div>

                <div style="height:40px;"></div> <button class="btn-main" onclick="saveContact()"
                    style="box-shadow: 0 5px 15px rgba(155, 158, 206, 0.4);">保存资料</button>
                <div style="height:30px;"></div>
            </div>
        </div>
        <div id="app-group-create" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('group-create')">
                        <span style="font-size:16px;color:#666;">取消</span>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">发起群聊</span></div>
                    <div class="header-right" onclick="submitCreateGroup()">
                        <span style="font-size:16px;color:var(--theme-purple);font-weight:600;">完成</span>
                    </div>
                </div>
            </div>

            <div class="app-body" style="padding: 20px 16px;">

                <label class="setting-label">群聊名称</label>
                <div class="input-wrapper">
                    <input type="text" id="group-name-input" class="setting-input" placeholder="例如：异世界冒险小队">
                </div>

                <label class="setting-label">选择你的身份 (我是谁)</label>
                <div id="group-me-list" class="select-list-container">
                </div>

                <label class="setting-label" style="margin-top:20px;">选择群成员 (邀请谁)</label>
                <div id="group-contact-list" class="select-list-container">
                </div>

                <div style="height:50px;"></div>
            </div>
        </div>
        <div id="modal-relation-select" class="modal-overlay" style="z-index: 210;">
            <div class="modal-card">
                <div class="close-modal"
                    onclick="document.getElementById('modal-relation-select').style.display='none'">×
                </div>
                <h3 style="margin-top:0;">添加关系</h3>

                <p style="font-size:12px;color:#999;margin-bottom:10px;">选择一个对象，并定义关系 (如: 父亲, 宿敌, 暗恋对象)</p>

                <label class="setting-label">关联对象</label>
                <div class="input-wrapper">
                    <select id="rel-target-select" class="setting-input" style="background-image:none;"></select>
                </div>

                <label class="setting-label">关系描述</label>
                <div class="input-wrapper">
                    <input type="text" id="rel-desc-input" class="setting-input" placeholder="例如：前男友、合伙人...">
                </div>

                <button class="btn-main" onclick="confirmAddRelation()">确定添加</button>
            </div>
        </div>
        <div id="app-chat-settings" class="app-window" style="background: #F2F2F7;">
            <div class="app-header" style="background: #fff;">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('chat-settings')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">聊天设置</span></div>
                    <div class="header-right" style="width:40px;"></div>
                </div>
            </div>

            <div class="app-body">

                <div style="margin: 20px 0 8px 20px; font-size:13px; color:#888;">外观</div>
                <div class="ios-group">
                    <div class="setting-row" onclick="openSubPage('visual')">
                        <div class="ios-text-box">
                            <div class="ios-title">头像与昵称</div>
                        </div>
                        <svg class="ios-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>

                <div style="margin: 0 0 8px 20px; font-size:13px; color:#888;">记忆与设定</div>
                <div class="ios-group">
                    <div class="setting-row">
                        <div class="ios-text-box">
                            <div class="ios-title">短期记忆</div>
                            <div class="ios-desc">携带的历史消息数量</div>
                        </div>
                        <div style="display:flex; align-items:center;">
                            <input type="number" id="setting-context-limit" value="25" class="ios-value-input"
                                onchange="saveContextLimit(this.value)">
                            <span style="color:#8E8E93; font-size:15px; margin-left:4px;">条</span>
                        </div>
                    </div>

                    <div class="setting-row" onclick="openWorldBookMountSelector()">
                        <div class="ios-text-box">
                            <div class="ios-title">世界书挂载</div>
                            <div id="wb-mount-status" class="ios-desc">未挂载局部设定</div>
                        </div>
                        <svg class="ios-arrow" viewBox="0 0 24 24">
                            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
                        </svg>
                    </div>
                </div>

                <div style="margin: 0 0 8px 20px; font-size:13px; color:#888;">环境</div>
                <div class="ios-group">
                    <div class="setting-row">
                        <div class="ios-text-box">
                            <div class="ios-title">环境增强模式</div>
                            <div class="ios-desc">实时注入时间、天气和时差</div>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="env-mode-switch" onchange="toggleEnvMode(this)">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <div id="env-settings-panel" style="display:none; background:#fff;">

                        <div id="view-mode-single" class="city-info-box">
                            <div class="flight-connector">
                                <svg class="flight-path-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <path class="flight-line-bg" d="M 0,75 C 80,75 220,25 300,25" />
                                    <path class="flight-line-dash" d="M 0,75 C 80,75 220,25 300,25" />
                                </svg>
                                <div class="plane-wrapper">
                                    <svg viewBox="0 0 24 24" width="24" height="24">
                                        <path
                                            d="M21,16V14L13,9V3.5A1.5,1.5,0,0,0,11.5,2A1.5,1.5,0,0,0,10,3.5V9L2,14V16L10,13.5V19L8,20.5V22L11.5,21L15,22V20.5L13,19V13.5L21,16Z" />
                                    </svg>
                                </div>
                            </div>

                            <div class="city-card" onclick="openCityModal('user')">
                                <div class="city-card-header">
                                    <div class="city-icon-bg"><svg viewBox="0 0 24 24" width="20" height="20"
                                            fill="#9B9ECE">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                        </svg></div>
                                    <div class="city-label-group">
                                        <div class="city-label-title">我的位置<svg class="verified-icon"
                                                viewBox="0 0 24 24">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-user-fake" class="city-name-main">未设置</div>
                                    </div>
                                </div>
                                <div id="ui-user-real" class="city-name-sub">映射: (空)</div>
                                <div id="ui-user-weather" class="city-weather-info">--</div>
                            </div>

                            <div class="city-card" onclick="openCityModal('char')">
                                <div class="city-card-header">
                                    <div class="city-icon-bg" style="background:#F4F4FF;"><svg viewBox="0 0 24 24"
                                            width="18" height="18" fill="#9B9ECE">
                                            <path
                                                d="M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z" />
                                        </svg></div>
                                    <div class="city-label-group">
                                        <div class="city-label-title">对方位置<svg class="verified-icon"
                                                viewBox="0 0 24 24">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-char-fake" class="city-name-main">未设置</div>
                                    </div>
                                </div>
                                <div id="ui-char-real" class="city-name-sub">映射: (空)</div>
                                <div id="ui-char-weather" class="city-weather-info">--</div>
                            </div>
                        </div>

                        <div id="view-mode-group" style="display:none; padding:16px;">
                            <div class="city-card-wide" onclick="openCityModal('user')">
                                <div class="city-card-header">
                                    <div class="city-label-group">
                                        <div class="city-label-title">我的当前位置 (群同步)<svg class="verified-icon"
                                                viewBox="0 0 24 24" style="margin-left:6px;">
                                                <path
                                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                                            </svg></div>
                                        <div id="ui-user-fake-group" class="city-name-main"
                                            style="font-size:18px; margin-top:2px;">未设置</div>
                                    </div>
                                </div>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-top:8px; border-top:1px solid #f9f9f9; padding-top:8px;">
                                    <div id="ui-user-real-group" class="city-name-sub">映射: (空)</div>
                                    <div id="ui-user-weather-group" class="city-weather-info" style="color:#9B9ECE;">--
                                    </div>
                                </div>
                            </div>
                            <div style="font-size:12px; color:#999; margin:20px 0 10px 4px;">其他成员位置</div>
                            <div id="env-group-list-container"></div>
                        </div>

                        <div style="padding:15px; font-size:12px; color:#999; line-height:1.5; text-align:center;">💡
                            映射真实城市以获取实时天气</div>
                    </div>
                </div>

                <div id="modal-wb-mount" class="modal-overlay" style="z-index: 310;">
                    <div class="modal-card">
                        <div class="close-modal"
                            onclick="document.getElementById('modal-wb-mount').style.display='none'">×</div>
                        <h3 style="margin-top:0;">选择局部设定</h3>
                        <p style="font-size:12px;color:#999;margin-bottom:15px;">勾选要挂载到当前会话的世界书 (全局设定默认生效)</p>
                        <div id="wb-mount-list" style="max-height:300px; overflow-y:auto;"></div>
                        <button class="btn-main" onclick="saveWbMount()">保存挂载</button>
                    </div>
                </div>

                <div id="sub-page-visual" class="sub-page" style="background: #F2F2F7;">
                    <div class="app-header" style="background: #fff;">
                        <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                        <div class="header-content">
                            <div class="header-left" onclick="closeSubPage('visual')"
                                style="width: 40px; padding-left: 5px;">
                                <svg viewBox="0 0 24 24" width="28" height="28">
                                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                                </svg>
                            </div>
                            <div class="header-title"><span style="font-size:17px;font-weight:600;">外观设置</span></div>
                            <div class="header-right" onclick="saveVisualSettings()">
                                <span style="font-size:16px;color:var(--theme-purple);font-weight:600;">完成</span>
                            </div>
                        </div>
                    </div>

                    <div class="app-body" style="padding-top: 10px;">

                        <div style="margin: 10px 0 8px 24px; font-size:13px; color:#888;">选择要修改的对象</div>

                        <div
                            style="background: #fff; border-radius: 12px; margin: 0 16px 20px 16px; padding: 15px 0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                            <div id="visual-target-container" class="visual-target-list" style="padding: 10px 16px;">
                            </div>
                        </div>

                        <div
                            style="background: #fff; border-radius: 12px; margin: 0 16px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">

                            <div style="display:flex; justify-content:center; margin-bottom:20px;">
                                <div style="position:relative;">
                                    <div id="visual-preview"
                                        style="width:100px; height:100px; background:#eee; border-radius:50%; background-size:cover; background-position:center; border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    </div>
                                    <div onclick="document.getElementById('visual-file-input').click()"
                                        style="position:absolute; bottom:0; right:0; width:32px; height:32px; background:var(--theme-purple); border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; border:2px solid #fff; cursor:pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.15);">
                                        <svg viewBox="0 0 24 24" width="18" height="18" fill="white">
                                            <path
                                                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                                        </svg>
                                    </div>
                                    <input type="file" id="visual-file-input" hidden accept="image/*"
                                        onchange="handleVisualAvatarFile(this)">
                                </div>
                            </div>

                            <div style="text-align:center; font-size:18px; font-weight:600; margin-bottom:25px; color:#333;"
                                id="visual-target-name">未知</div>

                            <label class="setting-label">显示昵称 (仅在本会话生效)</label>
                            <div class="input-wrapper">
                                <input type="text" id="visual-alias-input" class="setting-input" placeholder="默认为原名">
                            </div>

                            <div class="setting-row" style="padding: 10px 0; border-bottom: 1px solid #f9f9f9;">
                                <div class="ios-text-box">
                                    <div class="ios-title" style="font-size:15px;">头像形状</div>
                                </div>
                                <div class="shape-selector">
                                    <div id="shape-circle" class="shape-option active"
                                        onclick="setVisualShape('circle')">圆形</div>
                                    <div id="shape-square" class="shape-option" onclick="setVisualShape('square')">圆角
                                    </div>
                                </div>
                            </div>

                            <div class="setting-row" style="padding: 15px 0; border-bottom: 1px solid #f9f9f9;">
                                <div class="ios-text-box">
                                    <div class="ios-title" style="font-size:15px;">头像大小</div>
                                </div>
                                <div style="display:flex; align-items:center; width: 140px;">
                                    <input type="range" id="visual-size-slider" class="morandi-slider" min="30" max="60"
                                        step="2" oninput="updateVisualSizeVal(this.value)">
                                    <span id="visual-size-val"
                                        style="width:40px; text-align:right; font-size:12px; color:#888;">40px</span>
                                </div>
                            </div>

                            <div class="setting-row" style="padding: 10px 0; border-bottom: none;">
                                <div class="ios-text-box">
                                    <div class="ios-title" style="font-size:15px;">显示头像</div>
                                </div>
                                <label class="ios-switch">
                                    <input type="checkbox" id="visual-show-switch" checked
                                        onchange="toggleVisualVisibility(this)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div style="padding:20px; text-align:center; color:#999; font-size:12px;">
                            设置仅对当前设备上的当前会话生效
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="modal-city-select" class="modal-overlay" style="z-index: 300;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-city-select').style.display='none'">×
                </div>
                <h3 style="margin-top:0;">定位设置</h3>

                <label class="setting-label">显示名称 (Roleplay用)</label>
                <div class="input-wrapper">
                    <input type="text" id="city-fake-input" class="setting-input" placeholder="例如：哥谭市 / 魔法学院">
                </div>

                <label class="setting-label">真实映射城市 (API查询用)</label>
                <div class="input-wrapper">
                    <input type="text" id="city-real-input" class="setting-input"
                        placeholder="例如：New York / London / Beijing">
                </div>
                <p style="font-size:12px;color:#999;margin-bottom:15px;">请填写英文城市名或拼音 (如 Shanghai)，以便API准确识别。</p>

                <button class="btn-main" onclick="saveCitySelection()">保存设定</button>
            </div>
        </div>
        <div id="app-worldbook" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('worldbook')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>
                    <div class="header-title"><span style="font-size:17px;font-weight:600;">世界书</span></div>
                    <div class="header-right" style="gap:15px; padding-right:10px;">
                        <div id="wb-btn-select" onclick="toggleWbSelectMode()"
                            style="cursor:pointer; display:flex; color:var(--theme-purple);">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor">
                                <path
                                    d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z" />
                            </svg>
                        </div>

                        <div id="wb-btn-add" onclick="openWorldBookEdit()" style="cursor:pointer; display:flex;">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-body" style="padding: 10px 16px;">
                <div class="avatar-tabs" style="margin-bottom:10px;">
                    <div class="avatar-tab active" id="wb-tab-global" onclick="switchWorldBookTab('global')">全局设定</div>
                    <div class="avatar-tab" id="wb-tab-local" onclick="switchWorldBookTab('local')">局部设定</div>
                </div>

                <div id="wb-category-bar" class="category-scroll-container">
                </div>

                <div id="worldbook-list-container" style="padding-bottom: 80px;"></div>
            </div>

            <div id="wb-bottom-bar" class="wb-bottom-bar">
                <div class="wb-bar-btn" onclick="openWbMoveModal()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="#666">
                        <path
                            d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z" />
                    </svg>
                    <span>移动分类</span>
                </div>
                <div class="wb-bar-btn danger" onclick="batchDeleteWb()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="#FF3B30" stroke-width="2">
                        <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                    </svg>
                    <span>删除</span>
                </div>
            </div>
        </div>

        <div id="modal-cat-mgr" class="modal-overlay" style="z-index: 400;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-cat-mgr').style.display='none'">×</div>
                <h3 style="margin-top:0;">分类管理</h3>

                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="new-cat-name" class="setting-input" placeholder="新分类名称"
                        style="height:40px; margin:0;">
                    <button class="btn-main" onclick="addNewCategory()"
                        style="width:80px; margin:0; padding:0;">添加</button>
                </div>

                <div style="font-size:12px;color:#999;margin-bottom:8px;">删除分类时，其下内容会自动移入默认分类</div>

                <div id="cat-mgr-list"
                    style="max-height:300px; overflow-y:auto; border:1px solid #f0f0f0; border-radius:12px;">
                </div>
            </div>
        </div>

        <div id="modal-wb-move" class="modal-overlay" style="z-index: 410;">
            <div class="modal-card">
                <div class="close-modal" onclick="document.getElementById('modal-wb-move').style.display='none'">×</div>
                <h3>移动到...</h3>
                <div id="move-cat-list" style="max-height:300px; overflow-y:auto;">
                </div>
            </div>
        </div>

        <div id="app-worldbook-edit" class="app-window" style="background: #F9F9FC;">
            <div class="app-header">
                <div style="height:calc(10px + env(safe-area-inset-top));"></div>
                <div class="header-content">
                    <div class="header-left" onclick="closeApp('worldbook-edit')">
                        <svg viewBox="0 0 24 24" width="28" height="28">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                        </svg>
                    </div>

                    <div class="header-title"><span id="wb-edit-title"
                            style="font-size:17px;font-weight:600;">编辑词条</span></div>

                    <div class="header-right"
                        style="width: auto; min-width: 40px; display: flex; align-items: center; justify-content: flex-end; gap: 16px; padding-right: 10px;">
                        <div id="btn-del-wb" onclick="deleteWorldBookEntry()"
                            style="display:none; cursor:pointer; padding: 4px;">
                            <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="#B26B61"
                                stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </div>

                        <div onclick="saveWorldBookEntry()" style="cursor:pointer; display:flex;">
                            <svg viewBox="0 0 24 24" width="26" height="26" fill="#9B9ECE">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="app-body" style="padding: 20px 16px;">
                <div class="wb-edit-type-segment">
                    <div id="wb-edit-segment-global" class="wb-edit-segment-item active"
                        onclick="switchWbEditType('global')">全局设定</div>
                    <div id="wb-edit-segment-local" class="wb-edit-segment-item" onclick="switchWbEditType('local')">
                        局部设定</div>
                </div>
                <label class="setting-label">词条名称</label>
                <div class="input-wrapper">
                    <input type="text" id="wb-name" class="setting-input" placeholder="例如：魔法原理 / 家族历史">
                </div>
                <label class="setting-label">所属分类</label>
                <div class="input-wrapper">
                    <select id="wb-category-select" class="setting-input" style="background-image:none;">
                    </select>
                </div>
                <label class="setting-label">触发机制</label>
                <div class="settings-card" style="margin:0 0 16px 0;">
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>常驻激活 (Constant)</h4>
                            <p>无需触发词，永远注入到Prompt中</p>
                        </div>
                        <label class="ios-switch">
                            <input type="checkbox" id="wb-constant" onchange="toggleWbKeywords(this)">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div id="wb-keyword-group">
                    <label class="setting-label">触发关键词 (英文逗号分隔)</label>
                    <div class="input-wrapper">
                        <input type="text" id="wb-keys" class="setting-input" placeholder="例如：魔法, 吟唱, mana">
                    </div>
                </div>

                <label class="setting-label">内容设定 (Content)</label>
                <div class="input-wrapper">
                    <textarea id="wb-content" class="setting-input" style="height:150px; line-height:1.5;"
                        placeholder="输入该词条的具体设定内容..."></textarea>
                </div>

                <label class="setting-label">高级选项</label>
                <div class="settings-card" style="margin:0;">
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>注入位置</h4>
                            <p>影响AI认知的优先级</p>
                        </div>
                        <select id="wb-position"
                            style="border:none; bg:transparent; text-align:right; font-size:14px; color:#666;">
                            <option value="top">顶部</option>
                            <option value="bottom">底部</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <div class="settings-text">
                            <h4>注入权重 (Order)</h4>
                            <p>数字越大越靠后</p>
                        </div>
                        <input type="number" id="wb-order" value="100"
                            style="width:50px; border:none; text-align:right;">
                    </div>
                </div>


            </div>
        </div>
        <div id="msg-context-menu-overlay" class="msg-menu-overlay" style="display: none;" onclick="hideMsgMenu()">
            <div id="msg-menu-box" class="msg-menu-box">
                <div class="msg-menu-item" onclick="handleCopyMsg()">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="#666">
                        <path
                            d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                    </svg>
                    <span>复制</span>
                </div>
                <div class="msg-menu-line"></div>
                <div class="msg-menu-item danger" onclick="handleDeleteMsg()">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="#FF3B30">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                    </svg>
                    <span>删除</span>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="js/db.js"></script>
    <script src="js/render.js"></script>
    <script src="js/main.js"></script>

</body>

</html>